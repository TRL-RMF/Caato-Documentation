<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CAATO Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="caato.html">CAATO*</a></li><li class="chapter-item expanded "><a href="Software.html"><strong aria-hidden="true">1.</strong> Software*</a></li><li class="chapter-item expanded "><a href="Mechanical.html"><strong aria-hidden="true">2.</strong> Mechanical*</a></li><li class="chapter-item expanded "><a href="Electrical.html"><strong aria-hidden="true">3.</strong> Electrical & Electronics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Table.html"><strong aria-hidden="true">3.1.</strong> Table of Electronics*</a></li><li class="chapter-item expanded "><a href="Power.html"><strong aria-hidden="true">3.2.</strong> Power Diagram and Schematics</a></li><li class="chapter-item expanded "><a href="Programmable.html"><strong aria-hidden="true">3.3.</strong> Programmable Logic Controller</a></li><li class="chapter-item expanded "><a href="Pcb.html"><strong aria-hidden="true">3.4.</strong> PCB</a></li></ol></li><li class="chapter-item expanded "><a href="Other.html"><strong aria-hidden="true">4.</strong> Other Peripherals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Arm.html"><strong aria-hidden="true">4.1.</strong> CAATO Arm</a></li><li class="chapter-item expanded "><a href="Strip.html"><strong aria-hidden="true">4.2.</strong> LED Strip</a></li><li class="chapter-item expanded "><a href="Alexa.html"><strong aria-hidden="true">4.3.</strong> Amazon Alexa</a></li><li class="chapter-item expanded "><a href="Panel.html"><strong aria-hidden="true">4.4.</strong> LED Panel</a></li><li class="chapter-item expanded "><a href="Roboteq.html"><strong aria-hidden="true">4.5.</strong> Roboteq and Motor Tuning</a></li></ol></li><li class="chapter-item expanded "><a href="BOM.html"><strong aria-hidden="true">5.</strong> BOM</a></li><li class="chapter-item expanded "><a href="Operation.html"><strong aria-hidden="true">6.</strong> Operation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="site.html"><strong aria-hidden="true">6.1.</strong> On-Site Operation</a></li><li class="chapter-item expanded "><a href="3D.html"><strong aria-hidden="true">6.2.</strong> 3D Mapping</a></li><li class="chapter-item expanded "><a href="testing.html"><strong aria-hidden="true">6.3.</strong> Testing Plan (Navigation)</a></li></ol></li><li class="chapter-item expanded "><a href="Annex.html"><strong aria-hidden="true">7.</strong> Annex</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CAATO Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="caato"><a class="header" href="#caato">CAATO</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>The CAATO is a small, nimble Autonomous Ground Vehicle (AGV) developed off of the LOCUST platform with more powerful and accurate motors and a patented (TBC) trolley docking mechanism. This platform will be the first-ever robot to be deployed under the Robotic middleware framework RMF 2.0 program and is developed in joint collaboration with Changi Airport.</p>
<p>Checkout the CAATO repository for more information: <a href="https://github.com/TRL-RMF/caato2">caato github</a></p>
<h2 id="operational-workflow"><a class="header" href="#operational-workflow">Operational WorkFlow</a></h2>
<p><img src="./img/download_(1).png" alt="download (1).png" /></p>
<h2 id="autonomy"><a class="header" href="#autonomy">Autonomy</a></h2>
<h3 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h3>
<p>The autonomy of the CAATO implementation consists of two main parts: navigation stack and computer vision intelligence.</p>
<p>A single board computer (SBC) and sagemaker is used to achieve the two parts. Currently both are running ROS Noetic with Ubuntu 20.04 setup.</p>
<h3 id="architecture"><a class="header" href="#architecture">Architecture</a></h3>
<p>Major components of the overall system is shown below in the figure.</p>
<ul>
<li>NUC
<ul>
<li>Perform mapping, localization, path planninig</li>
</ul>
</li>
<li>SageMaker</li>
<li>Roboteq controller
<ul>
<li>Perform BLDC motors control (closed loop speed control, i.e. <code>cmd_vel</code>)</li>
</ul>
</li>
<li>Pixhawk IMU
<ul>
<li>Perform data fusion with odometry</li>
<li>GPS location if outdoor</li>
</ul>
</li>
<li>Hokuyo LiDAR
<ul>
<li>To perform 270 degree laser scan by combining one front-left LIDAR and one one right-rear LIDAR</li>
</ul>
</li>
<li>Ouster LiDAR (OS1-32)
<ul>
<li>To perform 360 degree laser scan needed to carry out mapping and localization.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="software"><a class="header" href="#software">Software</a></h1>
<h2 id="general-operability--overview"><a class="header" href="#general-operability--overview">General Operability &amp; Overview</a></h2>
<ul>
<li>For Caato2 to carry out its tasks using ROS, certain commands are needed to be executed</li>
<li>Various packages are available to be implemented onto Caato2
<ul>
<li>Git Clone from <a href="https://github.com/TRL-RMF/caato2">GitHub - CAATO</a></li>
</ul>
</li>
</ul>
<h2 id="packages"><a class="header" href="#packages">Packages</a></h2>
<ol>
<li>
<h2 id="caato2_bringup"><a class="header" href="#caato2_bringup">caato2_bringup</a></h2>
</li>
<li>
<h2 id="caato2_navigation"><a class="header" href="#caato2_navigation">caato2_navigation</a></h2>
</li>
<li>caato2_gazebo</li>
<li>AMCL3d
<ul>
<li><strong>Adaptive Monte-Carlo Localization in 3D</strong> is a particle filter that allows you to estimate where a robot is within a 3D environment without using GPS, for example in indoor environments.</li>
</ul>
</li>
</ol>
<h2 id="launch-files"><a class="header" href="#launch-files">Launch Files</a></h2>
<ol>
<li>Caato2_bringup
<ul>
<li>Launches certain relevant nodes which are needed for basic operation and functionality
<ul>
<li>Roboteq Differential Driver - Control the motors</li>
<li>Lasers - Activates the lasers used by Caato2</li>
<li>Teleop - Enable manual control of Caato2</li>
<li>DS4 Driver - Enable control of Caato2 using a remote joystick</li>
</ul>
</li>
</ul>
</li>
<li>Caato2_navigation
<ul>
<li>Launches relevant stacks needed for navigation
<ul>
<li>AMCL</li>
<li>DWA</li>
<li>EBAND (Preferred)</li>
<li>TEB</li>
</ul>
</li>
</ul>
</li>
<li>
<h2 id="cartographer-2d--3d"><a class="header" href="#cartographer-2d--3d">(Cartographer) (2D &amp; 3D)</a></h2>
</li>
<li>Xnergy charger
<ul>
<li>roslaunch xnergy_charger_rcu xnergy_charger_modbus.launch
<ul>
<li>Launches the modbus communication between the charger and the RCU</li>
</ul>
</li>
<li>rosservice call /xnergy_charger_rcu/start_charging
<ul>
<li>Initiates the charging process</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="rviz"><a class="header" href="#rviz">RViz</a></h2>
<ul>
<li>RViz is a 3D visualization software tool for robots, sensors, and algorithms. It enables you to see the robot’s perception of its world (real or simulated). The purpose of RViz is to enable you to visualize the state of a robot. It uses sensor data to try to create an accurate depiction of what is going on in the robot’s environment</li>
</ul>
<h2 id="gazebo"><a class="header" href="#gazebo">Gazebo</a></h2>
<ul>
<li>Gazebo is a 3D robot simulator. Its objective is to simulate a robot, giving you a close substitute to how your robot would behave in a real-world physical environment. It can compute the impact of forces (such as gravity)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mechanical"><a class="header" href="#mechanical">Mechanical</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="electricacl--electronics"><a class="header" href="#electricacl--electronics">Electricacl &amp; Electronics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="table-of-electronics"><a class="header" href="#table-of-electronics">Table of Electronics</a></h1>
<p>double check</p>
<div class="table-wrapper"><table><thead><tr><th>COMPONENT</th><th>MODEL NUMBER</th><th>#</th><th>PORTS</th><th>VOLTAGE RATING</th><th>MAX CURRENT DRAW</th><th>REMARKS</th></tr></thead><tbody>
<tr><td>HOKUYO 2D LIDAR</td><td>UST-10LX</td><td>2</td><td>ETHERNET + POWER</td><td>24</td><td></td><td></td></tr>
<tr><td>PIXHAWK IMU/GPS</td><td>PIXHAWK 4</td><td>1</td><td>USB</td><td>-</td><td></td><td>Connected to SBC</td></tr>
<tr><td>REAL SENSE DEPTH CAMERA</td><td>D435</td><td>2</td><td>USB </td><td>-</td><td></td><td>Connected to SBC</td></tr>
<tr><td>ROUTER</td><td>AX11000</td><td>1</td><td>POWER + ETHERNET</td><td>12</td><td></td><td></td></tr>
<tr><td>MIC-770 V2 (SBC)</td><td></td><td>1</td><td>POWER</td><td>19</td><td></td><td>Might change</td></tr>
<tr><td>PLC</td><td>CX9020EL1809EL2809EL3681x2EL6022EL7332</td><td>1</td><td>POWER + ETHERNET+RS485</td><td>24</td><td></td><td></td></tr>
<tr><td>LEISHEN 3D LIDAR</td><td>C16-700B</td><td>1</td><td>POWER + ETHERNET</td><td>12</td><td></td><td></td></tr>
<tr><td>DREAMVU 360 CAMERA</td><td>PAL USB</td><td>1</td><td>USB</td><td>-</td><td></td><td>Connected to SBC</td></tr>
<tr><td>WHEEL MOTOR + ROBOTEQ</td><td>SBL3260T</td><td>2</td><td>POWER + ENCODER + HALL SENSORS+RS485</td><td>24</td><td></td><td></td></tr>
<tr><td>LIFTING MOTOR</td><td>24V DC MOTOR</td><td>1</td><td>POWER+BRAKE</td><td>24</td><td></td><td></td></tr>
<tr><td>JETSON </td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
<tr><td>INFRARED SENSOR</td><td>GP2Y0A21YK</td><td>2</td><td>POWER+ANALOG OUT (JST terminal)</td><td>5</td><td></td><td></td></tr>
<tr><td>LASER BREAK SENSOR</td><td>EE-SX 674</td><td>2</td><td>POWER + ANALOG OUT</td><td>5</td><td></td><td></td></tr>
<tr><td>E-STOP BUTTON</td><td>AVW411-R</td><td>1</td><td>1NC1NO</td><td>--</td><td></td><td></td></tr>
<tr><td>KARTECH E-STOP</td><td>3A4663</td><td>1</td><td>POWER+DIG OUTx2</td><td>9-30V</td><td></td><td></td></tr>
<tr><td>FORCE RESISTOR</td><td>FSR MODEL 408 34-23845</td><td>6</td><td>VIN + VOUT</td><td>--</td><td> </td><td>Might Change</td></tr>
<tr><td>DC-DC SOLID STATE RELAY</td><td>1DD220D25</td><td>1</td><td>VIN +VOUT, VCONTROL + GND</td><td>&lt;220V, 3-32V</td><td>25A</td><td>Between PLC and Roboteq Supply</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="power-diagram-and-schematics"><a class="header" href="#power-diagram-and-schematics">Power Diagram and Schematics</a></h1>
<p>double check add in extra stuff</p>
<p>CAATO is powered by two 24V batteries (28.4V at full charge) in parallel, connected to a Xnergy receiver unit for wireless charging. The power is separated into two distinctions, propulsion and electronics.</p>
<p>The propulsion line provides power to the drive motor through the RoboteQ SBL3260T module, and is protected by a dedicated fuse, fly-back diode and various switches.</p>
<p>To cater to the different electronics, three voltage buses are provided by different DC-DC regulators (12V, 19V and 24V). The electronics line is protected by a single 10A fuse and placed in series with a switch, before being regulated at the various voltages. Each voltage bus is also connected to a switch then to individual terminal blocks for greater control and safety over the components.</p>
<p><img src="./img/Power.png" alt="CAATO_Power_Diagram_210721.png" /></p>
<p>CAATO Power Schemetic</p>
<p><img src="./img/Schematic.png" alt="Schematic_CAATO_v2_2021-10-01.png" /></p>
<p><a href="./pdf/Schematic.pdf">Schematic_CAATO PLC.pdf</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="programmable-logic-controller-plc"><a class="header" href="#programmable-logic-controller-plc">Programmable Logic Controller (PLC)</a></h1>
<p>A programmable logic controller (PLC) was added for the second iteration of CAATO. Currently, we are using an Allen Bradley Micro820 . We intend for the PLC to satisfy 3 main objectives.</p>
<ol>
<li>Safety Layer - In the event the x86 computing layer experiences failure, the PLC will take over to bring the robot to a safe state. Two critical areas of concern are motion and battery power. For the former, all motion commands are forwarded through the PLC to ensure no additional movements are given in the event of emergency. For the latter, the flow of power from the battery and Xnergy charger are controlled from the PLC.</li>
<li>Actuator Control - The PLC’s power, ruggedness and expandable I/O provide advantages over a basic microcontroller. We intend for the PLC to take over control of the trolley lift arm, which is currently operated by an Arduino Uno.</li>
<li>Machine Interface and Status Monitoring - The PLC will act as a central control hub, monitoring the status of electronics and the individual voltage terminals. This information will be displayed on an LCD touchscreen for quick troubleshooting and testing.</li>
</ol>
<p><a href="https://www.notion.so/Software-1491aca9b447436388bce194a45310fa">Software</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pcb"><a class="header" href="#pcb">PCB</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other-peripherals"><a class="header" href="#other-peripherals">Other Peripherals</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="caato-arm"><a class="header" href="#caato-arm">CAATO Arm</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="led-strip"><a class="header" href="#led-strip">LED Strip</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="amazon-alexa"><a class="header" href="#amazon-alexa">Amazon Alexa</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="led-panel"><a class="header" href="#led-panel">LED Panel</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="roboteq-and-motor-tuning"><a class="header" href="#roboteq-and-motor-tuning">Roboteq and Motor Tuning</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bom"><a class="header" href="#bom">BOM</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deployment--operation-concerns"><a class="header" href="#deployment--operation-concerns">Deployment &amp; Operation Concerns</a></h1>
<h1 id="3d-mapping"><a class="header" href="#3d-mapping">3D Mapping</a></h1>
<h1 id="3d-mapping-notes"><a class="header" href="#3d-mapping-notes">3D Mapping Notes</a></h1>
<h2 id="1-initial-mapping"><a class="header" href="#1-initial-mapping">1. Initial Mapping</a></h2>
<p>In order to start mapping, we need to run the mapping launch file and simultaneously record rosbag</p>
<p>Example of such mapping launch file:</p>
<pre><code class="language-jsx">&lt;launch&gt;
    &lt;!-- &lt;include file=&quot;$(find caato2_bringup)/launch/include/description_caato_3d.launch&quot; /&gt; --&gt;

    &lt;include file=&quot;$(find caato2_bringup)/launch/include/caato2_3d_lasers.launch&quot; /&gt;

    &lt;include file=&quot;$(find roboteq_diff_driver)/launch/driver.launch&quot; &gt;
    &lt;arg name=&quot;base_frame&quot; value=&quot;base_link&quot;/&gt;
    &lt;arg name=&quot;pub_odom_tf&quot; value=&quot;true&quot;/&gt;
    &lt;/include&gt;

    &lt;include file=&quot;$(find caato_teleop)/launch/ds4.launch&quot; /&gt;

&lt;/launch&gt;
</code></pre>
<p>After running the launch file, run <code>rosbag record -a</code> in another terminal.</p>
<p>After completing the mapping, kill the rosbag and followed by the launch file.</p>
<h2 id="2-obtaining-the-map"><a class="header" href="#2-obtaining-the-map">2. Obtaining the map</a></h2>
<p>In this stage make use of offline cart node in google cartographer and pass the bag as an argument</p>
<p>The command would be:</p>
<pre><code class="language-jsx">roslaunch cartographer_ros offline_cart_3d.launch bag_filenames:=&quot;&lt;/path_to_bag&gt;&quot;
</code></pre>
<p>After the node completes cleanly, a .pbstream file will be created.</p>
<p>offline_cart_node.launch:</p>
<pre><code class="language-jsx">&lt;launch&gt;
  &lt;param name=&quot;/use_sim_time&quot; value=&quot;true&quot; /&gt;

  &lt;node name=&quot;rviz&quot; pkg=&quot;rviz&quot; type=&quot;rviz&quot; required=&quot;true&quot;
      args=&quot;-d $(find cartographer_ros)/configuration_files/demo_3d.rviz&quot; /&gt;

  &lt;node name=&quot;cartographer_offline_node&quot; pkg=&quot;cartographer_ros&quot;
      type=&quot;cartographer_offline_node&quot; args=&quot;
          -configuration_directory $(find cartographer_ros)/configuration_files
          -configuration_basenames cart_3d.lua
          -urdf_filenames $(find cartographer_ros)/urdf/os1_sensor.urdf
          -bag_filenames $(arg bag_filenames)&quot;
      output=&quot;screen&quot;&gt;
    &lt;remap from=&quot;points2&quot; to=&quot;/os_cloud_node/points&quot; /&gt;
    &lt;remap from=&quot;imu&quot; to=&quot;/os_cloud_node/imu&quot; /&gt;
  &lt;/node&gt;

  &lt;node name=&quot;cartographer_occupancy_grid_node&quot; pkg=&quot;cartographer_ros&quot;
      type=&quot;cartographer_occupancy_grid_node&quot; args=&quot;-resolution 0.05&quot; /&gt;
&lt;/launch&gt;
</code></pre>
<p>Remember you need to pass .lua configuration and the lidar sensor urdf files in the offline cart launch. The example of those files can be seen below:</p>
<p>cart_3d.lua:</p>
<pre><code class="language-jsx">
include &quot;map_builder.lua&quot;
include &quot;trajectory_builder.lua&quot;

options = {
  map_builder = MAP_BUILDER,
  trajectory_builder = TRAJECTORY_BUILDER,
  map_frame = &quot;map&quot;,
  tracking_frame = &quot;os_imu&quot;,
  published_frame = &quot;base_link&quot;,
  odom_frame = &quot;base_link&quot;,
  provide_odom_frame = false,
  publish_frame_projected_to_2d = false,
  use_odometry = false,
  use_nav_sat = false,
  use_landmarks = false,
  num_laser_scans = 0,
  num_multi_echo_laser_scans = 0,
  num_subdivisions_per_laser_scan = 1,
  num_point_clouds = 1,
  lookup_transform_timeout_sec = 0.2,
  submap_publish_period_sec = 0.3,
  pose_publish_period_sec = 5e-3,
  trajectory_publish_period_sec = 30e-3,
  rangefinder_sampling_ratio = 1.,
  odometry_sampling_ratio = 1.,
  fixed_frame_pose_sampling_ratio = 1.,
  imu_sampling_ratio = 1.,
  landmarks_sampling_ratio = 1.,
}
-- Original defaults
TRAJECTORY_BUILDER_3D.num_accumulated_range_data = 1

MAP_BUILDER.use_trajectory_builder_3d = true
MAP_BUILDER.num_background_threads = 4

POSE_GRAPH.optimization_problem.huber_scale = 5e2
POSE_GRAPH.optimize_every_n_nodes = 320
POSE_GRAPH.constraint_builder.sampling_ratio = 0.03
POSE_GRAPH.optimization_problem.ceres_solver_options.max_num_iterations = 500
POSE_GRAPH.constraint_builder.min_score = 0.62
POSE_GRAPH.constraint_builder.global_localization_min_score = 0.66

-- Modifications
TRAJECTORY_BUILDER_3D.ceres_scan_matcher.translation_weight = 5.

TRAJECTORY_BUILDER_3D.use_online_correlative_scan_matching = true
TRAJECTORY_BUILDER_3D.imu_gravity_time_constant = .1

-- No point of trying to SLAM over the points on your cart.
TRAJECTORY_BUILDER_3D.min_range = 1.0
TRAJECTORY_BUILDER_3D.max_range = 50

-- These were just my first guess: use more points for SLAMing and adapt a bit for the ranges that are bigger for cars.
TRAJECTORY_BUILDER_3D.high_resolution_adaptive_voxel_filter.max_length = 5.
TRAJECTORY_BUILDER_3D.high_resolution_adaptive_voxel_filter.min_num_points = 250.
TRAJECTORY_BUILDER_3D.low_resolution_adaptive_voxel_filter.max_length = 8.
TRAJECTORY_BUILDER_3D.low_resolution_adaptive_voxel_filter.min_num_points = 400.

-- The submaps felt pretty big - since the car moves faster, we want them to be
-- slightly smaller. You are also slamming at 10cm - which might be aggressive
-- for cars and for the quality of the laser. I increased 'high_resolution',
-- you might need to increase 'low_resolution'. Increasing the
-- '*num_iterations' in the various optimization problems also trades
-- performance/quality.
TRAJECTORY_BUILDER_3D.submaps.high_resolution = .25
TRAJECTORY_BUILDER_3D.submaps.low_resolution = .60
TRAJECTORY_BUILDER_3D.submaps.num_range_data = 270
TRAJECTORY_BUILDER_3D.ceres_scan_matcher.ceres_solver_options.max_num_iterations = 50

-- Trying loop closing too often will cost CPU and not buy you a lot. There is
-- little point in trying more than once per submap.
MAP_BUILDER.pose_graph.optimize_every_n_nodes = 100
MAP_BUILDER.pose_graph.constraint_builder.sampling_ratio = 0.03
MAP_BUILDER.pose_graph.optimization_problem.ceres_solver_options.max_num_iterations = 200

MAP_BUILDER.pose_graph.constraint_builder.min_score = 0.5

-- Crazy search window to force loop closure to work. All other changes are probably not needed.
--MAP_BUILDER.sparse_pose_graph.constraint_builder.max_constraint_distance = 250.
--MAP_BUILDER.sparse_pose_graph.constraint_builder.fast_correlative_scan_matcher_3d.linear_xy_search_window = 250.
--MAP_BUILDER.sparse_pose_graph.constraint_builder.fast_correlative_scan_matcher_3d.linear_z_search_window = 30.
--MAP_BUILDER.sparse_pose_graph.constraint_builder.fast_correlative_scan_matcher_3d.angular_search_window = math.rad(60.)
--MAP_BUILDER.sparse_pose_graph.constraint_builder.ceres_scan_matcher_3d.ceres_solver_options.max_num_iterations = 50
</code></pre>
<p>os1_sensor.urdf</p>
<pre><code class="language-jsx">&lt;robot name=&quot;os_sensor&quot;&gt;
  &lt;material name=&quot;orange&quot;&gt;
    &lt;color rgba=&quot;1.0 0.5 0.2 1&quot; /&gt;
  &lt;/material&gt;
  &lt;material name=&quot;gray&quot;&gt;
    &lt;color rgba=&quot;0.2 0.2 0.2 1&quot; /&gt;
  &lt;/material&gt;

  &lt;link name=&quot;os_imu&quot;&gt;
    &lt;visual&gt;
      &lt;origin xyz=&quot;0.0 0.0 0.0&quot; /&gt;
      &lt;geometry&gt;
        &lt;box size=&quot;0.06 0.04 0.02&quot; /&gt;
      &lt;/geometry&gt;
      &lt;material name=&quot;orange&quot; /&gt;
    &lt;/visual&gt;
  &lt;/link&gt;

  &lt;link name=&quot;os_lidar&quot;&gt;
    &lt;visual&gt;
      &lt;origin xyz=&quot;0.0 0.0 0.0&quot; /&gt;
      &lt;geometry&gt;
        &lt;cylinder length=&quot;0.07&quot; radius=&quot;0.05&quot; /&gt;
      &lt;/geometry&gt;
      &lt;material name=&quot;gray&quot; /&gt;
    &lt;/visual&gt;
  &lt;/link&gt;

  &lt;link name=&quot;os_sensor&quot; /&gt;

  &lt;link name=&quot;base_link&quot; /&gt;

  &lt;!-- Legacy data --&gt;
  &lt;link name=&quot;os&quot; /&gt;

  &lt;joint name=&quot;os_link_joint_legacy&quot; type=&quot;fixed&quot;&gt;
    &lt;parent link=&quot;base_link&quot; /&gt;
    &lt;child link=&quot;os&quot; /&gt;
    &lt;origin xyz=&quot;0.00 0. 0.03618&quot; rpy=&quot;0. 0 0&quot; /&gt;
  &lt;/joint&gt;

  &lt;joint name=&quot;sensor_link_joint&quot; type=&quot;fixed&quot;&gt;
    &lt;parent link=&quot;base_link&quot; /&gt;
    &lt;child link=&quot;os_sensor&quot; /&gt;
    &lt;origin xyz=&quot;0 0 0&quot; rpy=&quot;0 0 0&quot; /&gt;
  &lt;/joint&gt;

  &lt;joint name=&quot;imu_link_joint&quot; type=&quot;fixed&quot;&gt;
    &lt;parent link=&quot;os_sensor&quot; /&gt;
    &lt;child link=&quot;os_imu&quot; /&gt;
    &lt;origin xyz=&quot;0.006253 -0.011775 0.007645&quot; rpy=&quot;0 0 0&quot; /&gt;
  &lt;/joint&gt;

  &lt;joint name=&quot;os_link_joint&quot; type=&quot;fixed&quot;&gt;
    &lt;parent link=&quot;os_sensor&quot; /&gt;
    &lt;child link=&quot;os_lidar&quot; /&gt;
    &lt;origin xyz=&quot;0.0 0.0 0.03618&quot; rpy=&quot;0 0 3.14159&quot; /&gt;
  &lt;/joint&gt;

&lt;/robot&gt;
</code></pre>
<h2 id="3-obtain-pcd-file"><a class="header" href="#3-obtain-pcd-file">3. Obtain PCD file</a></h2>
<p>In order to obtain the PCD file, we make use of cartographer’s build in node called assets_writer_cart_3d.</p>
<p>The command is as follows:</p>
<pre><code class="language-jsx">roslaunch cartographer_ros assets_writer_cart_3d.launch
****bag_filenames:=${HOME}/Downloads/b3-2016-04-05-14-14-00.bag pose_graph_filename:=${HOME}/Downloads/b3-2016-04-05-14-14-00.bag.pbstream
</code></pre>
<p>This will be create a PCD file.</p>
<p>After obtaining the initial PCD file, it has to be down sampled in order to reduce the time it takes to create the .bt file in the next step.</p>
<p>The command is as follows:</p>
<pre><code class="language-jsx">pcl_voxel_grid &lt;input&gt;.pcd downsampled.pcd -leaf 0.05,0.05,0.05
</code></pre>
<p>A new down sampled .pcd file will be created.</p>
<h2 id="4-obtain-bt-file"><a class="header" href="#4-obtain-bt-file">4. Obtain BT file</a></h2>
<p>To obtain BT file, we have to make use of octomap tracking server and pcdTopointcloud </p>
<p>The command for pcdTopointcloud launch is as follows:</p>
<pre><code class="language-jsx">roslaunch octomap_server pcdTopointcloud.launch
</code></pre>
<p>Remember to change the file name in the pcdTopointcloud.launch and build again</p>
<p>The command is as follows:</p>
<pre><code class="language-jsx">roslaunch octomap_server octomap_tracking_server.launch
</code></pre>
<p>Followed by octomap_saver</p>
<pre><code class="language-jsx">rosrun octomap_server octomap_saver -f &lt;name_of_map&gt;.bt octomap_full:=octomap_full
</code></pre>
<p>This will produce a .BT file</p>
<p>Octomap_tracking_server.launch sample code:</p>
<pre><code class="language-jsx">&lt;launch&gt;

  &lt;arg name=&quot;path&quot; default=&quot;&quot;/&gt;
  &lt;arg name=&quot;changeIdFrame&quot; default=&quot;/talker/changes&quot;/&gt;

    &lt;!-- you can load an exisiting tree with &lt;node ... args=&quot;tree.bt&quot;&gt; !--&gt;
    &lt;node pkg=&quot;octomap_server&quot; type=&quot;octomap_tracking_server_node&quot; name=&quot;octomap_talker&quot;    output=&quot;screen&quot; args=&quot;$(arg path)&quot;&gt;
        &lt;param name=&quot;resolution&quot; value=&quot;0.05&quot; /&gt;
        &lt;param name=&quot;frame_id&quot; type=&quot;string&quot; value=&quot;map&quot; /&gt;
        &lt;param name=&quot;sensor_model/max_range&quot; value=&quot;20.0&quot; /&gt;
        &lt;param name=&quot;save_directory&quot; value=&quot;$(optenv OCTOMAP_SAVE_DIR ./)&quot; /&gt;
        &lt;param name=&quot;track_changes&quot; value=&quot;true&quot;/&gt;
        &lt;param name=&quot;listen_changes&quot; value=&quot;false&quot;/&gt;
        &lt;param name=&quot;topic_changes&quot; value=&quot;/octomap_tracking_server/changeset&quot; /&gt;
            &lt;param name=&quot;change_id_frame&quot; value=&quot;$(arg changeIdFrame)&quot; /&gt;
            &lt;param name=&quot;min_change_pub&quot; value=&quot;0&quot; /&gt;
            &lt;param name=&quot;filter_ground&quot; value=&quot;false&quot; /&gt;
            &lt;param name=&quot;pointcloud_max_z&quot; value=&quot;0.5&quot; /&gt;
            &lt;param name=&quot;pointcloud_min_z&quot; value=&quot;-0.7&quot; /&gt;
            &lt;param name=&quot;base_frame_id&quot; value=&quot;base_link&quot; /&gt;
        &lt;!--remap from=&quot;cloud_in&quot; to=&quot;/rgbdslam/batch_clouds&quot; /--&gt;
    &lt;/node&gt;
&lt;/launch&gt;
</code></pre>
<p>The most important arguments are:</p>
<ol>
<li>pointcloud_max_z</li>
<li>pointcloud_min_z</li>
<li>base_frame_id</li>
</ol>
<h2 id="5-obtaining-2d-map"><a class="header" href="#5-obtaining-2d-map">5. Obtaining 2D map</a></h2>
<p>This step is similar to step 4, but with changes to pointcloud_max_z and pointcloud_min_z in the tracking_server launch file. The changes are as follows</p>
<ol>
<li>pointcloud_max_z = 0.5</li>
<li>pointcloud_min_z = -0.5</li>
</ol>
<p>Then rerun the following command:</p>
<pre><code class="language-jsx">roslaunch octomap_server octomap_tracking_server.launch
</code></pre>
<p>🌟In this step, we will be making sure of the normal 2D map_saver instead of the octomap_server. Furthermore, change the topic that the server subscribes to from /map to /projected_map</p>
<p>Use the following command:</p>
<pre><code class="language-jsx">rosrun map_server map_saver map:=/projected_map -f name_of_map
</code></pre>
<p>Map.yaml and map.png files will be created.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="on-site-operation"><a class="header" href="#on-site-operation">On-Site Operation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="3d-mapping-1"><a class="header" href="#3d-mapping-1">3D Mapping</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="testing-plan-navigation"><a class="header" href="#testing-plan-navigation">Testing Plan (Navigation)</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="annex"><a class="header" href="#annex">Annex</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
